âœ“ Starting...
 âœ“ Ready in 2.8s
 âœ“ Compiled /middleware in 346ms (200 modules)
ğŸŒ Middleware executado para: /login
 â—‹ Compiling /login ...
 âœ“ Compiled /login in 6.5s (1300 modules)
 âœ“ Compiled in 634ms (482 modules)
ğŸŒ Middleware executado para: /_next/static/css/app/layout.css
ğŸŒ Middleware executado para: /_next/static/css/app/(public)/login/layout.css
ğŸŒ Middleware executado para: /_next/static/chunks/webpack.js
ğŸŒ Middleware executado para: /_next/static/chunks/main-app.js
ğŸŒ Middleware executado para: /_next/static/chunks/app-pages-internals.js
 GET /login 200 in 7905ms
 âœ“ Compiled in 704ms (454 modules)
ğŸŒ Middleware executado para: /_next/static/chunks/app/error.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/layout.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/(public)/login/page.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/not-found.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/global-error.js
ğŸŒ Middleware executado para: /_next/static/chunks/_app-pages-browser_node_modules_next_dist_client_dev_noop-turbopack-hmr_js.js
ğŸŒ Middleware executado para: /login
 POST /login 200 in 626ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 â—‹ Compiling /admin/audit ...
 âœ“ Compiled /admin/audit in 3.5s (3630 modules)
ğŸŒ Middleware executado para: /_next/static/webpack/55e70880ff7da3ae.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.55e70880ff7da3ae.hot-update.js
 GET /admin/audit 200 in 4204ms
ğŸŒ Middleware executado para: /_next/static/css/app/layout.css
ğŸŒ Middleware executado para: /_next/static/chunks/webpack.js
ğŸŒ Middleware executado para: /_next/static/chunks/main-app.js
ğŸŒ Middleware executado para: /_next/static/chunks/app-pages-internals.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/layout.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/error.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/not-found.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/admin/layout.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/admin/audit/page.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/global-error.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/layout.js
ğŸŒ Middleware executado para: /admin/audit
ğŸŒ Middleware executado para: /_next/static/chunks/_app-pages-browser_node_modules_next_dist_client_dev_noop-turbopack-hmr_js.js
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
 POST /admin/audit 200 in 198ms
ğŸŒ Middleware executado para: /admin/audit
ğŸŒ Middleware executado para: /api/system/maintenance-status
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 â—‹ Compiling /api/system/maintenance-status ...
 âœ“ Compiled /api/system/maintenance-status in 864ms (3657 modules)
ğŸŒ Middleware executado para: /_next/static/webpack/7db4236f035954b5.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/7db4236f035954b5.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.7db4236f035954b5.hot-update.js
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.7db4236f035954b5.hot-update.js
 GET /api/system/maintenance-status 200 in 1241ms
ğŸŒ Middleware executado para: /api/system/maintenance-status
 GET /api/system/maintenance-status 200 in 51ms
 POST /admin/audit 200 in 359ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 329ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 295ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 291ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 328ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 367ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 334ms
ğŸŒ Middleware executado para: /login
ğŸ” ServerAction: Verificando bloqueio para usuÃ¡rio: a8919fc9-ec1a-4c59-938d-28d1da2b953f
ğŸ” ServerAction: Resultado do bloqueio: false
Failed to create audit log: Error: Acesso negado: Apenas master admins podem usar este cliente
    at createSupabaseAdminClient (src\core\supabase\admin.ts:82:10)
    at async createAuditLog (src\features\security\audit-logger.ts:102:21)
    at async signInWithPassword (src\app\actions\auth\login.ts:127:4)
  80 |
  81 |   if (!authorized) {
> 82 |     throw new Error('Acesso negado: Apenas master admins podem usar este cliente');
     |          ^
  83 |   }
  84 |
  85 |   if (!supabaseUrl || !supabaseServiceRoleKey) {
 POST /login 200 in 1294ms
ğŸŒ Middleware executado para: /banban-fashion
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
 â—‹ Compiling /[slug] ...
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
ğŸŒ Middleware executado para: /_next/static/webpack/737fd068ae01bc7a.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/737fd068ae01bc7a.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.737fd068ae01bc7a.hot-update.js
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.737fd068ae01bc7a.hot-update.js
 âœ“ Compiled /[slug] in 4.6s (7021 modules)
 POST /admin/audit 200 in 2350ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/%5Bslug%5D/layout.js
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/layout.js
ğŸŒ Middleware executado para: /banban-fashion
 GET /banban-fashion 200 in 6267ms
ğŸŒ Middleware executado para: /_next/static/chunks/app/(protected)/%5Bslug%5D/page.js
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
 POST /admin/audit 200 in 343ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
ğŸŒ Middleware executado para: /_next/static/css/app/layout.css
ğŸŒ Middleware executado para: /banban-fashion
 GET /banban-fashion 200 in 268ms
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
 POST /admin/audit 200 in 282ms
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
 POST /banban-fashion 200 in 77ms
ğŸŒ Middleware executado para: /banban-fashion
ğŸŒ Middleware executado para: /api/system/maintenance-status
 GET /api/system/maintenance-status 200 in 173ms
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸŒ Middleware executado para: /api/system/maintenance-status
 GET /api/system/maintenance-status 200 in 52ms
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
 POST /banban-fashion 200 in 66ms
ğŸŒ Middleware executado para: /banban-fashion
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
ğŸŒ Middleware executado para: /banban-fashion
ğŸŒ Middleware executado para: /api/modules/configuration
ğŸŒ Middleware executado para: /api/dashboard/layout
ğŸŒ Middleware executado para: /_next/static/chunks/_app-pages-browser_src_clients_banban_components_index_ts.js
 POST /banban-fashion 200 in 325ms
ğŸ” Verificando bloqueio para usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f na rota /banban-fashion
ğŸ” Resultado do bloqueio para a8919fc9-ec1a-4c59-938d-28d1da2b953f: false
 â—‹ Compiling /api/dashboard/layout ...
ğŸŒ Middleware executado para: /_next/static/webpack/db569fea6ad3da1b.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/db569fea6ad3da1b.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.db569fea6ad3da1b.hot-update.js
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.db569fea6ad3da1b.hot-update.js
ğŸŒ Middleware executado para: /_next/static/webpack/084ce94d7ae3fc55.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/084ce94d7ae3fc55.webpack.hot-update.json
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.084ce94d7ae3fc55.hot-update.js
ğŸŒ Middleware executado para: /_next/static/webpack/webpack.084ce94d7ae3fc55.hot-update.js
 âœ“ Compiled /api/dashboard/layout in 3.4s (7026 modules)
[ModuleConfigurationService] Carregando mÃ³dulos para organizaÃ§Ã£o: 2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4
[ModuleConfigurationService] Query executada. Error: null
[ModuleConfigurationService] Raw modules: 3
[ModuleConfigurationService] 3 mÃ³dulos carregados com a nova arquitetura
 GET /api/modules/configuration?organizationId=2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4 200 in 3906ms
ğŸŒ Middleware executado para: /api/modules/configuration
 GET /api/dashboard/layout?tenant_id=2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4 200 in 3983ms
ğŸŒ Middleware executado para: /_next/static/css/app/layout.css
ğŸŒ Middleware executado para: /api/dashboard/layout
 POST /banban-fashion 200 in 2539ms
[ModuleConfigurationService] Carregando mÃ³dulos para organizaÃ§Ã£o: 2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4
[ModuleConfigurationService] Query executada. Error: null
[ModuleConfigurationService] Raw modules: 3
[ModuleConfigurationService] 3 mÃ³dulos carregados com a nova arquitetura
 GET /api/modules/configuration?organizationId=2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4 200 in 514ms
 GET /api/dashboard/layout?tenant_id=2da2a9a7-89ec-48bf-a3bc-c46e58d5a9b4 200 in 523ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
ğŸ”„ Tentando encerrar sessÃ£o: 4d806c62-f0d3-4dad-86a9-b7bc1b1d0146
ğŸ‘¤ Perfil do usuÃ¡rio: { role: 'master_admin', organization_id: null }
ğŸ”§ Marcando sessÃ£o como inativa
ğŸ”§ Invalidando tokens JWT do usuÃ¡rio via RPC: a8919fc9-ec1a-4c59-938d-28d1da2b953f
âœ… Tokens JWT removidos via RPC. Resultado: true
ğŸ”§ Bloqueando usuÃ¡rio temporariamente: a8919fc9-ec1a-4c59-938d-28d1da2b953f
âœ… UsuÃ¡rio bloqueado temporariamente por 10 minutos
ğŸ”§ InvalidaÃ§Ã£o adicional via admin API
âš ï¸ Erro na invalidaÃ§Ã£o admin: Error [AuthApiError]: invalid JWT: unable to parse or verify signature, token is malformed: token contains an invalid number of segments
    at async terminateSession (src\app\(protected)\admin\audit\sessions-actions.ts:267:36)
  265 |     try {
  266 |       // Invalidar todas as sessÃµes JWT do usuÃ¡rio diretamente
> 267 |       const { error: adminError } = await supabase.auth.admin.signOut(targetUserId, 'global')
      |                                    ^
  268 |
  269 |       if (adminError) {
  270 |         console.debug('âš ï¸ Erro na invalidaÃ§Ã£o admin:', adminError) {
  __isAuthError: true,
  status: 403,
  code: 'bad_jwt'
}
ğŸ·ï¸ Criando marcador de bloqueio no lado do cliente
ğŸ“¡ InformaÃ§Ã£o de bloqueio a ser transmitida: {
  user_id: 'a8919fc9-ec1a-4c59-938d-28d1da2b953f',
  blocked_until: '2025-07-24T20:05:59.696Z',
  reason: 'session_terminated',
  timestamp: 1753386959696
}
âœ… Marcador de bloqueio preparado
ğŸ—‘ï¸ Invalidando caches relacionados ao usuÃ¡rio
âœ… PreparaÃ§Ã£o para limpeza de cache concluÃ­da
ğŸŒ Middleware executado para: /admin/audit
 POST /admin/audit 200 in 1344ms
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 311ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 302ms
ğŸŒ Middleware executado para: /admin/audit
ğŸ” Verificando bloqueio para usuÃ¡rio d5edd63c-1497-4925-a649-d348440d142b na rota /admin/audit
ğŸ” Resultado do bloqueio para d5edd63c-1497-4925-a649-d348440d142b: false
 POST /admin/audit 200 in 290ms
ğŸŒ Middleware executado para: /_next/static/css/app/layout.css
ğŸŒ Middleware executado para: /banban-fashion/alerts
ğŸ” Middleware: UsuÃ¡rio nÃ£o autenticado em /banban-fashion/alerts - verificando bloqueios recentes
ğŸ” Middleware: Headers de cookie disponÃ­veis: sim
ğŸ” Middleware: ConteÃºdo dos cookies (primeiros 200 chars): __next_hmr_refresh_hash__=27ae27b0024674d7f8893f620299203cbc7b4b7cceddff9a; sb-bopytcghbmuywfltmwhk-auth-token=
ğŸ” Middleware: PadrÃµes Supabase detectados: SIM
ğŸ” Middleware: Header de terminaÃ§Ã£o: ausente
ğŸ” Middleware: Detectados cookies Supabase OU header de terminaÃ§Ã£o - buscando usuÃ¡rios recÃ©m-bloqueados
ğŸ” Middleware: IP do cliente: ::1
ğŸ” Middleware: Buscando bloqueios desde: 2025-07-24T19:26:06.174Z
ğŸ” Middleware: Bloqueios recentes encontrados: 1, erro: nenhum
ğŸ” Middleware: Analisando 1 bloqueios recentes
ğŸ” Middleware: Bloqueio mais recente: usuÃ¡rio a8919fc9-ec1a-4c59-938d-28d1da2b953f, idade: 7s
ğŸ” Middleware: Tempo restante do bloqueio: 594s
ğŸš« Middleware: CORRELAÃ‡ÃƒO POSITIVA - usuÃ¡rio recÃ©m-bloqueado tentando acesso
ğŸ”„ Middleware: Redirecionando com parÃ¢metros para: http://localhost:3000/login?reason=session_terminated&blocked_until=594
ğŸŒ Middleware executado para: /login
 GET /login?reason=session_terminated&blocked_until=594 200 in 66ms
ğŸŒ Middleware executado para: /_next/static/css/app/(public)/login/layout.css
ğŸŒ Middleware executado para: /login
 GET /login 200 in 57ms