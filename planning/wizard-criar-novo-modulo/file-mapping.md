# üìÇ Mapeamento de Arquivos Afetados - Refatora√ß√£o Wizard

## üéØ Vis√£o Geral

Este documento mapeia todos os arquivos que ser√£o modificados durante a refatora√ß√£o do wizard de cria√ß√£o de m√≥dulos, organizados por impacto e fase de implementa√ß√£o.

---

## üìä **Resumo de Impacto**

| Categoria | Quantidade | Tipos de Modifica√ß√£o |
|-----------|------------|---------------------|
| **üî¥ Refatora√ß√£o Major** | 4 arquivos | Mudan√ßas estruturais significativas |
| **üü° Modifica√ß√£o Moderada** | 6 arquivos | Ajustes de l√≥gica e interface |
| **üü¢ Modifica√ß√£o Menor** | 8 arquivos | Updates menores, novos props |
| **‚ö™ Sem Altera√ß√£o** | 3 arquivos | Apenas para testes e valida√ß√£o |
| **üÜï Novos Arquivos** | 5 arquivos | Componentes e utilit√°rios novos |

---

## üóÇÔ∏è **Mapeamento Detalhado por Arquivo**

### **üî¥ REFATORA√á√ÉO MAJOR** 

#### **1. BasicConfigStep.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/wizard-steps/BasicConfigStep.tsx`

**Impacto**: ‚ö†Ô∏è **CR√çTICO** - Arquivo central da experi√™ncia

**Modifica√ß√µes Principais**:
```typescript
// ANTES: Campos manuais separados
const [nameFieldTouched, setNameFieldTouched] = useState(false);
const [formTouched, setFormTouched] = useState(false);

// DEPOIS: Auto-gera√ß√£o integrada
const generateIdentifiers = (name: string) => {
  const slug = generateSlug(name);
  return {
    slug,
    implementation_key: `${slug}-impl`,
    component_path: `${slug}Implementation`
  };
};
```

**Se√ß√µes Afetadas**:
- [ ] **Gera√ß√£o autom√°tica de identificadores** (linhas 125-132)
- [ ] **Acorde√£o para configura√ß√µes avan√ßadas** (linhas 511-578) 
- [ ] **Preview em tempo real** (nova se√ß√£o)
- [ ] **Valida√ß√µes em tempo real** (linhas 156-181)
- [ ] **Toggle implementa√ß√£o standard √∫nico** (linhas 566-575)

**Estimativa**: üïê **8-12 horas** de refatora√ß√£o

---

#### **2. ImplementationConfigStep.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/wizard-steps/ImplementationConfigStep.tsx`

**Impacto**: ‚ö†Ô∏è **ALTO** - Simplifica√ß√£o significativa

**Modifica√ß√µes Principais**:
```typescript
// ANTES: Campos manuais para tudo
<FormField name="implementation_key" />
<FormField name="component_path" />
<FormField name="version" />

// DEPOIS: Heran√ßa autom√°tica + customiza√ß√£o opcional
const implementationData = {
  implementation_key: config.auto_generated?.implementation_key || '',
  component_path: config.auto_generated?.component_path || '',
  version: config.basic?.version || '1.0.0', // Herdado
  ...formValues
};
```

**Se√ß√µes Afetadas**:
- [ ] **Remo√ß√£o de campos duplicados** (implementation_key, version)
- [ ] **Heran√ßa autom√°tica de identificadores**
- [ ] **Interface simplificada** com campos read-only
- [ ] **L√≥gica condicional** baseado em auto_create_standard

**Estimativa**: üïê **6-8 horas** de refatora√ß√£o

---

#### **3. useModuleWizard.ts** 
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/hooks/useModuleWizard.ts`

**Impacto**: ‚ö†Ô∏è **ALTO** - L√≥gica central do wizard

**Modifica√ß√µes Principais**:
```typescript
// ANTES: Valida√ß√£o step by step simples
const validateStep = (stepId: WizardStep) => {
  // Valida√ß√£o b√°sica
};

// DEPOIS: Valida√ß√£o condicional + auto-gera√ß√£o
const validateStep = (stepId: WizardStep, moduleType?: ModuleType) => {
  // L√≥gica condicional baseada no tipo
  if (stepId === 'client-config' && moduleType === 'standard') {
    return 'valid'; // Auto-skip para standard
  }
  // ... valida√ß√£o complexa
};

// NOVO: Tracking de campos auto-gerados
const [autoGeneratedFields, setAutoGeneratedFields] = useState({
  slug: '',
  implementation_key: '',
  component_path: ''
});
```

**Se√ß√µes Afetadas**:
- [ ] **L√≥gica de step condicional** (isStepVisible)
- [ ] **Progress calculation din√¢mico**
- [ ] **State management** para campos auto-gerados
- [ ] **Valida√ß√£o condicional** por tipo de m√≥dulo

**Estimativa**: üïê **10-14 horas** de refatora√ß√£o

---

#### **4. wizard-steps.ts**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/config/wizard-steps.ts`

**Impacto**: ‚ö†Ô∏è **MODERADO-ALTO** - Configura√ß√£o do fluxo

**Modifica√ß√µes Principais**:
```typescript
// ANTES: Steps est√°ticos
export const WIZARD_STEPS = [
  { id: 'module-type', ... },
  { id: 'basic-config', ... },
  { id: 'review-create', ... },
  { id: 'implementation-config', ... },
  { id: 'client-config', ... },
  { id: 'checklist', ... }
];

// DEPOIS: Steps condicionais
export function getVisibleSteps(moduleType: ModuleType, config: ModuleConfig) {
  const allSteps = WIZARD_STEPS;
  return allSteps.filter(step => {
    if (step.id === 'client-config') {
      return moduleType === 'custom';
    }
    if (step.id === 'implementation-config') {
      return !config.basic?.auto_create_standard;
    }
    return true;
  });
}
```

**Se√ß√µes Afetadas**:
- [ ] **isStepVisible() function** - l√≥gica condicional
- [ ] **getEffectiveStepIndex()** - c√°lculo din√¢mico
- [ ] **getTotalVisibleSteps()** - contagem din√¢mica

**Estimativa**: üïê **4-6 horas** de refatora√ß√£o

---

### **üü° MODIFICA√á√ÉO MODERADA**

#### **5. ClientConfigStep.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/wizard-steps/ClientConfigStep.tsx`

**Impacto**: üîß **MODERADO** - L√≥gica condicional

**Modifica√ß√µes**:
- [ ] **Mostrar apenas para m√≥dulos Custom**
- [ ] **Auto-skip para m√≥dulos Standard**
- [ ] **Mensagem explicativa** quando step √© pulado

**Estimativa**: üïê **2-4 horas**

---

#### **6. ModuleCreationWizard.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/ModuleCreationWizard.tsx`

**Impacto**: üîß **MODERADO** - Progress e navega√ß√£o

**Modifica√ß√µes**:
- [ ] **Progress bar din√¢mico** baseado em steps vis√≠veis
- [ ] **Navega√ß√£o inteligente** (pular steps)
- [ ] **Loading states** melhorados

**Estimativa**: üïê **3-5 horas**

---

#### **7. ChecklistStep.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/wizard-steps/ChecklistStep.tsx`

**Impacto**: üîß **MODERADO** - Interatividade

**Modifica√ß√µes**:
- [ ] **Links diretos** para arquivos/pastas
- [ ] **A√ß√µes contextuais** por item
- [ ] **Progress tracking** individual

**Estimativa**: üïê **6-8 horas** (Fase 3)

---

#### **8. ModuleWizardContext.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/contexts/ModuleWizardContext.tsx`

**Impacto**: üîß **BAIXO-MODERADO** - Context props

**Modifica√ß√µes**:
- [ ] **Novos campos** no context (auto_generated)
- [ ] **Memoiza√ß√£o** otimizada
- [ ] **Types** atualizados

**Estimativa**: üïê **1-2 horas**

---

#### **9. types/index.ts**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/types/index.ts`

**Impacto**: üîß **BAIXO-MODERADO** - Defini√ß√µes de tipos

**Modifica√ß√µes**:
```typescript
// NOVO: Tipos para auto-gera√ß√£o
export interface AutoGeneratedFields {
  slug: string;
  implementation_key: string;
  component_path: string;
}

export interface ModuleCreationConfig {
  // ... existing
  auto_generated?: AutoGeneratedFields;
  flow_config?: {
    skip_implementation_config?: boolean;
    skip_client_config?: boolean;
  };
}
```

**Estimativa**: üïê **1-2 horas**

---

#### **10. ReviewCreateStep.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/wizard-steps/ReviewCreateStep.tsx`

**Impacto**: üîß **BAIXO-MODERADO** - Auto-cria√ß√£o

**Modifica√ß√µes**:
- [ ] **Auto-cria√ß√£o de implementa√ß√£o** para Standard modules
- [ ] **Preview final** com dados auto-gerados
- [ ] **Confirma√ß√£o inteligente**

**Estimativa**: üïê **3-4 horas**

---

### **üü¢ MODIFICA√á√ÉO MENOR**

#### **11. ModuleCreationDialog.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/components/ModuleCreationDialog.tsx`

**Impacto**: üõ†Ô∏è **BAIXO** - Container component

**Modifica√ß√µes**:
- [ ] **Props adicionais** para feature flags
- [ ] **Loading states** melhorados

**Estimativa**: üïê **30min - 1 hora**

---

#### **12. ModuleCreationDialogContext.tsx**  
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/contexts/ModuleCreationDialogContext.tsx`

**Impacto**: üõ†Ô∏è **MUITO BAIXO** - Context simples

**Modifica√ß√µes**: Possivelmente nenhuma, apenas valida√ß√£o

**Estimativa**: üïê **15-30min**

---

#### **13-18. Outros arquivos menores**
- `useModuleCreationDialog.tsx` - hooks adicionais
- `useModulesData.ts` - data fetching  
- `ModuleTypeStep.tsx` - valida√ß√µes menores
- `SystemConfigContext.tsx` - feature flags
- `AutoConfigSwitch.tsx` - componente existente
- CSS/UI components - ajustes de styling

**Estimativa Total**: üïê **2-4 horas** combinadas

---

### **‚ö™ SEM ALTERA√á√ÉO (Apenas Valida√ß√£o)**

#### **19. Server Actions - CR√çTICO VALIDAR**
```
src/app/actions/admin/modules/
‚îú‚îÄ‚îÄ base-modules.ts                    ‚úÖ Sem altera√ß√£o
‚îú‚îÄ‚îÄ module-implementations.ts          ‚úÖ Sem altera√ß√£o  
‚îú‚îÄ‚îÄ tenant-module-assignments.ts       ‚úÖ Sem altera√ß√£o
‚îî‚îÄ‚îÄ schemas.ts                         ‚ö†Ô∏è  Validar compatibilidade
```

**A√ß√£o Required**: 
- [ ] **Testes extensivos** de compatibilidade
- [ ] **Valida√ß√£o** de que novos fields n√£o quebram schemas
- [ ] **Regression testing** completo

#### **20. Database/Supabase**
- [ ] **Sem altera√ß√µes** no schema
- [ ] **Valida√ß√£o** de que campos auto-gerados s√£o compat√≠veis
- [ ] **Testes** de integridade

---

### **üÜï NOVOS ARQUIVOS**

#### **21. StructurePreview.tsx** 
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/shared/StructurePreview.tsx`

```typescript
interface StructurePreviewProps {
  config: BasicModuleConfig;
  realTime?: boolean;
}

export const StructurePreview = ({ config, realTime = true }: StructurePreviewProps) => {
  // Real-time preview da estrutura de arquivos e URL
  return (
    <Card className="bg-blue-50 border-blue-200">
      <CardHeader>Preview em Tempo Real</CardHeader>
      <CardContent>
        {/* File structure tree */}
        {/* URL preview */}
        {/* Validation status */}
      </CardContent>
    </Card>
  );
};
```

**Estimativa**: üïê **4-6 horas**

#### **22. InteractiveChecklistItem.tsx**
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/checklist/InteractiveChecklistItem.tsx`

```typescript
interface ChecklistTask {
  id: string;
  title: string;
  description: string;
  actionType: 'open-folder' | 'open-file' | 'external-link' | 'none';
  actionData?: ActionData;
}

export const InteractiveChecklistItem = ({ task, onToggle }: Props) => {
  // Interactive checklist item with direct actions
  return (
    <div className="flex items-center justify-between p-4">
      {/* Checkbox + content */}
      {/* Action buttons */}
    </div>
  );
};
```

**Estimativa**: üïê **3-4 horas**

#### **23. TagsInput.tsx** (Fase 3 - Opcional)
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/components/shared/TagsInput.tsx`

**Estimativa**: üïê **4-6 horas** (se implementado)

#### **24. useChecklistProgress.ts** (Fase 3)
**Localiza√ß√£o**: `src/app/(protected)/admin/modules/development/hooks/useChecklistProgress.ts`

**Estimativa**: üïê **2-3 horas**

#### **25. wizard-analytics.ts**
**Localiza√ß√£o**: `src/utils/wizard-analytics.ts`

```typescript
export const trackWizardEvent = (event: WizardEvent, data: any) => {
  // Analytics tracking for wizard migration
};
```

**Estimativa**: üïê **1-2 horas**

---

## üìã **Matriz de Depend√™ncias**

### **Ordem de Implementa√ß√£o Recomendada**

#### **Fase 1 - Sprint 1.1**
```
1. types/index.ts (novos types) 
   ‚Üì
2. useModuleWizard.ts (context logic)
   ‚Üì  
3. BasicConfigStep.tsx (toggle √∫nico)
   ‚Üì
4. ImplementationConfigStep.tsx (remover toggle)
```

#### **Fase 1 - Sprint 1.2**  
```
1. BasicConfigStep.tsx (auto-gera√ß√£o)
   ‚Üì
2. ImplementationConfigStep.tsx (heran√ßa)
   ‚Üì
3. useModuleWizard.ts (valida√ß√£o)
   ‚Üì
4. Testes e valida√ß√£o
```

#### **Fase 2 - Sprint 2.1**
```
1. wizard-steps.ts (l√≥gica condicional)
   ‚Üì
2. useModuleWizard.ts (progress din√¢mico)  
   ‚Üì
3. ClientConfigStep.tsx (conditional display)
   ‚Üì
4. ModuleCreationWizard.tsx (navega√ß√£o)
```

#### **Fase 2 - Sprint 2.2**
```
1. StructurePreview.tsx (novo componente)
   ‚Üì
2. BasicConfigStep.tsx (accordion + preview)
   ‚Üì  
3. CSS/UI updates
   ‚Üì
4. Performance optimization
```

#### **Fase 3**
```
1. InteractiveChecklistItem.tsx (novo componente)
   ‚Üì
2. useChecklistProgress.ts (novo hook)
   ‚Üì
3. ChecklistStep.tsx (refatora√ß√£o)
   ‚Üì
4. TagsInput.tsx (se implementado)
```

---

## üîç **Arquivos de Risco**

### **üö® ALTO RISCO** - Requer aten√ß√£o especial

1. **BasicConfigStep.tsx** - Arquivo mais complexo, m√∫ltiplas mudan√ßas
2. **useModuleWizard.ts** - L√≥gica central, impacto em todo wizard
3. **Server Actions compatibility** - Breaking changes poss√≠veis

### **‚ö†Ô∏è M√âDIO RISCO** - Testes extensivos necess√°rios  

1. **ImplementationConfigStep.tsx** - Interface significativamente diferente
2. **wizard-steps.ts** - L√≥gica de fluxo alterada
3. **Progress calculation** - Matem√°tica pode quebrar

### **‚úÖ BAIXO RISCO** - Mudan√ßas menores

1. **Context components** - Mudan√ßas incrementais
2. **UI components** - Mostly styling  
3. **New components** - N√£o afetam c√≥digo existente

---

## üìä **Estimativas Consolidadas**

| Fase | Arquivos Afetados | Horas Estimadas | Risco |
|------|------------------|----------------|--------|
| **Fase 1.1** | 4 principais | 20-30 horas | üö® Alto |
| **Fase 1.2** | 3 principais | 15-20 horas | üö® Alto |  
| **Fase 2.1** | 4 arquivos | 10-15 horas | ‚ö†Ô∏è M√©dio |
| **Fase 2.2** | 3 + 1 novo | 15-20 horas | ‚ö†Ô∏è M√©dio |
| **Fase 3** | 2 + 3 novos | 15-25 horas | ‚úÖ Baixo |

**Total Estimado**: 75-110 horas (9-14 dias de desenvolvimento)

---

## ‚úÖ **Checklist de Valida√ß√£o por Arquivo**

### **Por arquivo modificado:**
- [ ] **Backup** do estado atual
- [ ] **Tests** existentes ainda passam  
- [ ] **TypeScript** sem erros
- [ ] **ESLint** warnings resolvidos
- [ ] **Performance** mantida ou melhorada
- [ ] **Accessibility** n√£o degradada
- [ ] **Mobile responsive** funcionando

### **Por fase completa:**
- [ ] **E2E tests** para todos os fluxos
- [ ] **Integration tests** com server actions  
- [ ] **Regression tests** para funcionalidades existentes
- [ ] **Performance benchmarks** comparativos
- [ ] **User acceptance** testing

---

**üìù Nota**: Este mapeamento deve ser atualizado conforme descobrimos depend√™ncias adicionais durante a implementa√ß√£o. Considere este um living document que evolui com o projeto.